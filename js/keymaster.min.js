(function(g){function q(a,d){for(var b=a.length;b--;)if(a[b]===d)return b;return-1}function v(a,d){var b,e,c,f,g;b=a.keyCode;-1==q(n,b)&&n.push(b);if(93==b||224==b)b=91;if(b in h)for(c in h[b]=!0,m)m[c]==b&&(p[c]=!0);else{for(k in h)h[k]=a[w[k]];if(p.filter.call(this,a)&&b in l)for(f=0;f<l[b].length;f++)if(e=l[b][f],e.scope==d||"all"==e.scope){g=0<e.mods.length;for(c in h)if(!h[c]&&-1<q(e.mods,+c)||h[c]&&-1==q(e.mods,+c))g=!1;(0!=e.mods.length||h[16]||h[18]||h[17]||h[91])&&!g||!1!==e.method(a,e)||
(a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation&&a.stopPropagation(),a.cancelBubble&&(a.cancelBubble=!0))}}}function p(a,d,b){var e,c;a=a.replace(/\s/g,"");c=a.split(",");""==c[c.length-1]&&(c[c.length-2]+=",");void 0===b&&(b=d,d="all");for(var f=0;f<c.length;f++)e=[],a=c[f].split("+"),1<a.length&&(e=t(a),a=[a[a.length-1]]),a=a[0],a=r[a]||a.toUpperCase().charCodeAt(0),a in l||(l[a]=[]),l[a].push({shortcut:c[f],scope:d,method:b,key:c[f],mods:e})}function u(){return s||"all"}
function t(a){a=a.slice(0,a.length-1);for(var d=0;d<a.length;d++)a[d]=m[a[d]];return a}var k,l={},h={16:!1,18:!1,17:!1,91:!1},s="all",m={"\u21e7":16,shift:16,"\u2325":18,alt:18,option:18,"\u2303":17,ctrl:17,control:17,"\u2318":91,command:91},r={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},n=[];
for(k=1;20>k;k++)r["f"+k]=111+k;var w={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(k in m)p[k]=!1;document.addEventListener("keydown",function(a){v(a,s)},!0);document.addEventListener("keyup",function(a){a=a.keyCode;var d,b=q(n,a);0<=b&&n.splice(b,1);if(93==a||224==a)a=91;if(a in h)for(d in h[a]=!1,m)m[d]==a&&(p[d]=!1)},!0);window.addEventListener("focus",function(){for(k in h)h[k]=!1;for(k in m)p[k]=!1},!1);var x=g.key;g.key=p;g.key.setScope=function(a){s=a||"all"};g.key.getScope=u;
g.key.deleteScope=function(a){var d,b,e;for(d in l)for(b=l[d],e=0;e<b.length;)b[e].scope===a?b.splice(e,1):e++};g.key.filter=function(a){return!0};g.key.isPressed=function(a){"string"==typeof a&&(a=r[a]||a.toUpperCase().charCodeAt(0));return-1!=q(n,a)};g.key.getPressedKeyCodes=function(){return n.slice(0)};g.key.noConflict=function(){var a=g.key;g.key=x;return a};g.key.unbind=function(a,d){var b=a.split("+"),e=[],c;1<b.length&&(e=t(b),a=b[b.length-1]);a=r[a]||a.toUpperCase().charCodeAt(0);void 0===
d&&(d=u());if(l[a])for(c in l[a]){var b=l[a][c],f;if(f=b.scope===d)a:if(b=b.mods,b.length!=e.length)f=!1;else{for(f=0;f<b.length;f++)if(b[f]!==e[f]){f=!1;break a}f=!0}f&&(l[a][c]={})}};"undefined"!==typeof module&&(module.exports=key)})(this);